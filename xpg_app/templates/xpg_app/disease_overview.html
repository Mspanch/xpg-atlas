<!DOCTYPE html>
<html>
<head>
  <title>Disease Associations ‚Äî XPG Atlas</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <style>
    body {
      background-color: #f8f9fa;
      font-family: 'Helvetica Neue', sans-serif;
    }

    .hit-yes { color: #198754; font-weight: 700; }
    .hit-no { color: #bbb; }

    .multi-hit { background: #fff7cc !important; }

    th {
      cursor: pointer;
      user-select: none;
    }

    /* ‚úî Correct arrow directions */
    .sort-desc::after { content: " ‚ñº"; }
    .sort-asc::after  { content: " ‚ñ≤"; }

    td, th { text-align: center; }
    td:first-child, th:first-child { text-align: left; }
  </style>
</head>

<body class="bg-light">

  <!-- NAVBAR -->
  <nav class="navbar navbar-dark navbar-expand-lg bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">XPG Atlas</a>

      <div class="navbar-nav">
        <a class="nav-link" href="/">Home</a>
        <a class="nav-link" href="https://doi.org/10.21203/rs.3.rs-5624085/v1" target="_blank">
          Original Paper
        </a>
        <a class="nav-link" href="https://version-12-0.string-db.org/cgi/globalenrichment?networkId=bLTOlM6CRnwt" target="_blank">
          STRING Analysis
        </a>
        <a class="nav-link active" href="/disease-overview/">Disease Association Overview</a>
      </div>

      <form class="d-flex ms-auto" method="get" action="/search/">
        <input class="form-control me-2" type="search" name="q" placeholder="Search Gene...">
        <button class="btn btn-outline-light">üîç</button>
      </form>
    </div>
  </nav>


  <div class="container py-5">

    <!-- REMOVED SUMMARY BOX -->

    <h2 class="mb-4">XPG Disease Associations</h2>

    <table id="diseaseTable" class="table table-bordered table-hover bg-white align-middle">
      <thead class="table-dark">
        <tr>
          <th data-sort="gene">Gene</th>

          <th data-sort="sfari">
            SFARI<br><small>Autism ‚Äî n={{ sfari_count }}</small>
          </th>

          <th data-sort="schema">
            SCHEMA<br><small>Schizophrenia ‚Äî n={{ schema_count }}</small>
          </th>

          <th data-sort="bipex">
            BipEx<br><small>Bipolar ‚Äî n={{ bipex_count }}</small>
          </th>

          <th data-sort="epi25">
            Epi25<br><small>Epilepsy ‚Äî n={{ epi25_count }}</small>
          </th>

          <th data-sort="total">
            Total Hits<br><small>‚â•2 hits: n={{ multi_hit_count }}</small>
          </th>
        </tr>
      </thead>

      <tbody>
        {% for row in rows %}
          {% if row.multi_sig_count > 0 %}
          <tr class="{% if row.multi_sig_count > 1 %}multi-hit{% endif %}">

            <td>
              <a href="{% url 'gene_detail' row.gene %}">
                <strong>{{ row.gene }}</strong>
              </a>
            </td>

            <td data-value="{{ row.sfari_sig|yesno:'1,0' }}"
                class="{% if row.sfari_sig %}hit-yes{% else %}hit-no{% endif %}">
              {% if row.sfari_sig %}‚úî{% else %}‚Äî{% endif %}
            </td>

            <td data-value="{{ row.schema_sig|yesno:'1,0' }}"
                class="{% if row.schema_sig %}hit-yes{% else %}hit-no{% endif %}">
              {% if row.schema_sig %}‚úî{% else %}‚Äî{% endif %}
            </td>

            <td data-value="{{ row.bipex_sig|yesno:'1,0' }}"
                class="{% if row.bipex_sig %}hit-yes{% else %}hit-no{% endif %}">
              {% if row.bipex_sig %}‚úî{% else %}‚Äî{% endif %}
            </td>

            <td data-value="{{ row.epi25_sig|yesno:'1,0' }}"
                class="{% if row.epi25_sig %}hit-yes{% else %}hit-no{% endif %}">
              {% if row.epi25_sig %}‚úî{% else %}‚Äî{% endif %}
            </td>

            <td data-value="{{ row.multi_sig_count }}">
              <strong>{{ row.multi_sig_count }}</strong>
            </td>

          </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- SORTING SCRIPT -->
  <script>
    document.querySelectorAll("th[data-sort]").forEach(th => {
      th.addEventListener("click", () => {

        const table = document.getElementById("diseaseTable").querySelector("tbody");
        const rows = Array.from(table.querySelectorAll("tr"));
        const colIndex = [...th.parentNode.children].indexOf(th);

        // FIRST CLICK SHOULD SORT DESCENDING (hits on top)
        const descending = !th.classList.contains("sort-desc");

        // Clear old arrows
        document.querySelectorAll("th").forEach(t => t.classList.remove("sort-asc", "sort-desc"));

        rows.sort((a, b) => {
          const A = a.children[colIndex].dataset.value ?? a.children[colIndex].innerText.trim();
          const B = b.children[colIndex].dataset.value ?? b.children[colIndex].innerText.trim();

          const numA = parseFloat(A);
          const numB = parseFloat(B);
          const numeric = !isNaN(numA) && !isNaN(numB);

          if (numeric) {
            return descending ? numB - numA : numA - numB;
          }
          return descending
            ? String(B).localeCompare(String(A))
            : String(A).localeCompare(String(B));
        });

        // Set arrow direction
        th.classList.add(descending ? "sort-desc" : "sort-asc");

        rows.forEach(r => table.appendChild(r));
      });
    });
  </script>

</body>
</html>
